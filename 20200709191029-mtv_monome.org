#+title: mtv-monome
* PITFALL: If I need to see the voice_jit or jit_test branches
they are in the old monome/ repo.
* TODO features
** timbre the board
higher tones are harsher
rightward tones are (warblier?)
** sustain: two buttons, "add these" and "release all"
"add these" has on/off state, stays in effect until it is released.
"release all" has no state -- it fires as soon as it's touched, and holding it does nothing.
** store pitchsets from sustain
** two keyboards, split keyboard
** amp=0 before freeing voice
** monomes, language share pitch LED messages
** transpose {pitchsets, ongoing notes, either keyboard}
** volume, timbre control for {sustained notes, either keyboard}
** redraw the whole screen often
*** why
Dropped messages to LEDs stop being a (hypothetical) problem.
Shading on both monomes becomes easier.
** flash the anchor
** reset buttons
*** silence all voices
*** redraw entire grid
*** ? restore shift to identity vector
to remove floating point error
** sustain to middle of bottom, and duplicate at both top corners
so that usually something can touch it
** make pitchsets available on a per-degree basis
** JI synth: print each note as it is played
* TODO clean
** handleSwitch should not know about MVar
 It should instead return an St -> St,
 and limit its IO to SuperCollider,
 and be called with mVarModify (or whatever the word is).

 handleSwitch :: forall app.
                 MVar (St app) -> ((X,Y), Switch) -> IO (Either String ())
** unify the handlers for JI and Keyboard
* TODO bugs
** crashes when a voice is not found
*** TODO Why does it crash?
Even conditional on not finding the note, shouldn't it just print an error and continue?
*** TODO Why is the voice not found?
** probably harmless: threadwait error
*** Whenever I quit, I get this error message.
 <interactive>: threadWait: invalid argument (Bad file descriptor)
*** It's extremely old. Probably harmless?
* infrastructure
** add tests
*** TODO test multiple handlers
**** hold 2 notes, press sustain, shift, release one of them
**** hold 2 notes, press sustain, shift, release one of them, release sustain
**** hold a note, shift, press another note, press sustain
**** hold a note, shift, press another note, press sustain, release them
** LedBecause: maybe don't distinguish between keys and sustain
 just use VoiceId
